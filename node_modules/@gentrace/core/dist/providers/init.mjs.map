{"version":3,"file":"init.mjs","sources":["init.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Configuration as Configuration } from \"../configuration\";\nimport { V1Api } from \"../api\";\nimport { getProcessEnv } from \"./utils\";\nexport let GENTRACE_API_KEY = \"\";\nexport let GENTRACE_BASE_PATH = \"\";\nexport let GENTRACE_BRANCH = \"\";\nexport let GENTRACE_COMMIT = \"\";\n// @deprecated: use GENTRACE_RESULT_NAME instead\nexport let GENTRACE_RUN_NAME = \"\";\nexport let GENTRACE_RESULT_NAME = \"\";\nexport let globalGentraceConfig = null;\nexport let globalGentraceApi = null;\nexport let globalRequestBuffer = {};\nexport let resetGlobalGentraceApi = () => {\n    globalGentraceConfig = null;\n};\nexport function init(values) {\n    const { apiKey, basePath, branch, commit, runName, resultName } = values !== null && values !== void 0 ? values : {};\n    if (!apiKey && !getProcessEnv(\"GENTRACE_API_KEY\")) {\n        throw new Error(\"Gentrace API key was provided neither by the `apiKey` param in the constructor nor by the `GENTRACE_API_KEY` env variable.\");\n    }\n    GENTRACE_API_KEY = apiKey || getProcessEnv(\"GENTRACE_API_KEY\");\n    GENTRACE_RUN_NAME = runName || getProcessEnv(\"GENTRACE_RUN_NAME\");\n    GENTRACE_RESULT_NAME = resultName || getProcessEnv(\"GENTRACE_RESULT_NAME\");\n    if (basePath) {\n        try {\n            const url = new URL(basePath);\n            if (url.pathname.startsWith(\"/api\")) {\n            }\n            else {\n                throw new Error('Gentrace base path must end in \"/api\".');\n            }\n        }\n        catch (err) {\n            throw new Error(`Invalid Gentrace base path: ${err.message}`);\n        }\n        GENTRACE_BASE_PATH = basePath;\n    }\n    globalGentraceConfig = new Configuration({\n        apiKey: GENTRACE_API_KEY,\n        basePath: GENTRACE_BASE_PATH,\n    });\n    globalGentraceApi = new V1Api(globalGentraceConfig);\n    if (branch) {\n        GENTRACE_BRANCH = branch;\n    }\n    if (commit) {\n        GENTRACE_COMMIT = commit;\n    }\n}\nexport function deinit() {\n    GENTRACE_API_KEY = \"\";\n    GENTRACE_BASE_PATH = \"\";\n    GENTRACE_BRANCH = \"\";\n    GENTRACE_COMMIT = \"\";\n    globalGentraceConfig = null;\n    globalGentraceApi = null;\n    globalRequestBuffer = {};\n}\nexport function flush() {\n    return __awaiter(this, void 0, void 0, function* () {\n        return (yield Promise.allSettled(Object.values(globalRequestBuffer))).every((result) => result.status === \"fulfilled\");\n    });\n}\n"],"names":["this"],"mappings":"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"}