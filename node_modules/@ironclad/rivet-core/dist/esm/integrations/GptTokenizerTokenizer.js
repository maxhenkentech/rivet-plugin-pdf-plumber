import {} from '../index.js';
import { encode, encodeChat } from 'gpt-tokenizer';
import Emittery from 'emittery';
import { getError } from '../utils/errors.js';
export class GptTokenizerTokenizer {
    emitter = new Emittery();
    on(event, listener) {
        this.emitter.on(event, listener);
    }
    getTokenCountForString(input, _info) {
        return encode(input).length;
    }
    getTokenCountForMessages(messages, _info) {
        try {
            const encodedChat = encodeChat(messages.map((message) => ({
                role: message.type,
                content: message.message,
                name: message.name,
            })), 'gpt-3.5-turbo');
            return encodedChat.length;
        }
        catch (err) {
            this.emitter.emit('error', getError(err));
            return 0;
        }
    }
}
